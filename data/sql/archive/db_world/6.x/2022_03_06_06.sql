-- DB update 2022_03_06_05 -> 2022_03_06_06
DROP PROCEDURE IF EXISTS `updateDb`;
DELIMITER //
CREATE PROCEDURE updateDb ()
proc:BEGIN DECLARE OK VARCHAR(100) DEFAULT 'FALSE';
SELECT COUNT(*) INTO @COLEXISTS
FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA = DATABASE() AND TABLE_NAME = 'version_db_world' AND COLUMN_NAME = '2022_03_06_05';
IF @COLEXISTS = 0 THEN LEAVE proc; END IF;
START TRANSACTION;
ALTER TABLE version_db_world CHANGE COLUMN 2022_03_06_05 2022_03_06_06 bit;
SELECT sql_rev INTO OK FROM version_db_world WHERE sql_rev = '1645908835613660800'; IF OK <> 'FALSE' THEN LEAVE proc; END IF;
--
-- START UPDATING QUERIES
--

INSERT INTO `version_db_world` (`sql_rev`) VALUES ('1645908835613660800');

SET @NPC := 80989;
SET @PATH := @NPC * 10;

DELETE FROM `creature_addon` WHERE `guid` = @NPC;
INSERT INTO `creature_addon` (`guid`, `path_id`) VALUES (@NPC, @PATH);
UPDATE `creature` SET `MovementType` = 2 WHERE `guid` = @NPC;

DELETE FROM `waypoint_data` WHERE `id` = @PATH;
INSERT INTO `waypoint_data` (`id`, `point`, `position_x`, `position_y`, `position_z`, `orientation`, `delay`) VALUES
(@PATH, 1, -9045.99, -613.365, 52.568, 0.937418, 0),
(@PATH, 2, -9036.76, -603.262, 54.4687, 0.813718, 0),
(@PATH, 3, -9033, -597.874, 56.0532, 1.00418, 0),
(@PATH, 4, -9032.44, -588.11, 56.2174, 1.69925, 0),
(@PATH, 5, -9030.78, -579.535, 56.1643, 1.12788, 0),
(@PATH, 6, -9026.16, -572.116, 55.1351, 1.09646, 0),
(@PATH, 7, -9026.83, -565.044, 54.9951, 1.82295, 0),
(@PATH, 8, -9031.18, -559.425, 55.1258, 2.52392, 0),
(@PATH, 9, -9037.24, -556.873, 55.122, 2.74776, 0),
(@PATH, 10, -9029.44, -560.833, 54.9018, 5.8167, 0),
(@PATH, 11, -9025.5, -565.307, 54.9058, 5.11181, 0),
(@PATH, 12, -9025.81, -571.837, 55.0615, 4.55222, 0),
(@PATH, 13, -9030.53, -579.62, 56.1519, 4.17326, 0),
(@PATH, 14, -9032.11, -587.058, 56.2744, 4.54436, 0),
(@PATH, 15, -9032.84, -598.507, 56.0457, 4.23413, 0),
(@PATH, 16, -9037.18, -603.403, 54.3608, 3.97102, 0),
(@PATH, 17, -9045.74, -612.645, 52.5056, 3.97888, 0),
(@PATH, 18, -9053.53, -621.068, 53.6789, 4.04956, 0);

--
-- END UPDATING QUERIES
--
UPDATE version_db_world SET date = '2022_03_06_06' WHERE sql_rev = '1645908835613660800';
COMMIT;
END //
DELIMITER ;
CALL updateDb();
DROP PROCEDURE IF EXISTS `updateDb`;
